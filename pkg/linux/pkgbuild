# pkg: pf-kernel

pkgname=pf-kernel
pkgver=pf-4.4
pkgdesc="pf-kernel is yet another Linux kernel fork which provides you with a handful of awesome features not merged into mainline"
url="https://pf.natalenko.name/"
source="https://github.com/pfactum/$pkgname"

_builddir="$srcdir"/$pkgname
_buildflags=""

download() {
    cd "$srcdir"
    if [ ! -d "$_builddir" ]; then
        git clone -b "$pkgver" --depth 1 "$source"
    fi
}

prepare() {
    cd "$_builddir"
    local i
    for i in $source; do
        case $i in
        *.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
        esac
    done

    mkdir -p /boot
    rm -rf /lib/modules/*
}

build() {
    cd "$_builddir"
    cp -f $PKG_DIR/kernel/config.x86_64 .config
    cp -f $PKG_DIR/kernel/Makefile Makefile
    echo "${KERNELVERSION}" > include/config/kernel.release
    export KERNELVERSION=${KERNELVERSION}

    make -j${threads} silentoldconfig
    make -j${threads} bzImage
    make -j$threads} modules
}

package() {
    cd "$_builddir"
    make -j1 install DESTDIR="$pkgdir" || return 1
    make -j1 modules_install DESTDIR="$pkgdir" || return 1
}
