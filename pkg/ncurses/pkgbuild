# package: ncurses

pkgname=ncurses
pkgver=6.0
pkgdesc="GNU console display library"
source="http://ftp.gnu.org/gnu/${pkgname}/${pkgname}-${pkgver}.tar.gz"
_builddir="$srcdir/$pkgname-$pkgver"
_buildflags="--prefix=/usr --without-cxx --without-cxx-bindings --enable-static \
    --without-debug --without-ada --disable-ext-mouse --enable-overwrite \
    --disable-pc-files --without-progs"

download() {
    cd "$srcdir"
    if [ ! -d "$_builddir" ]; then
        local i
        for i in $source; do
            case $i in
                *.tar.gz) curl -sSL "$i" | tar xz -C "$srcdir";;
                *.patch) cp "$workdir/$pkgname/$i" "$_builddir/$i";;
            esac
        done
    fi
}

prepare() {
    cd "$_builddir"
    local i
    for i in $source; do
        case $i in
            *.patch) patch -p1 -i "$i" || return 1;;
        esac
    done
}

build() {
    cd "$_builddir"
    ./configure $_buildflags
    make -j"${threads}"
}

package() {
    cd "$_builddir"
    if [ ! -f "$pkgdir/$pkgname-$pkgver.$pkgext" ]; then
        tmpdir=$(mktemp -d)
        make -j1 install DESTDIR="$tmpdir" || return 1
        cd $tmpdir
        find | cpio -o -H newc | gzip -9 > "$pkgdir/$pkgname-$pkgver.$pkgext"
        rm -rf $tmpdir
    fi
}
